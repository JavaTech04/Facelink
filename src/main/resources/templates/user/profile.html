<!DOCTYPE html>
<html lang="en" th:replace="~{user/index::dynamic(~{::main})}">
<head>
    <meta charset="UTF-8">
    <title>Profile</title>
</head>
<body>
<main>
    <div class="container">
        <div>
            <img src="https://th.bing.com/th/id/OIP.0PoDOSn6cnaaRwxnK0SqaAHaEK?rs=1&pid=ImgDetMain" class="cover-photo"
                 alt="Cover Photo">
            <button class="camera-button" onclick="alert('Coming soon!')">
                <i class="bi bi-camera"></i>
            </button>
        </div>
        <div class="profile-header">
            <div style="position: relative;">
                <img th:src="${#authentication.principal.account.accountInfo.avatar == null ? 'https://i0.wp.com/www.vidyadhirajamvk.org/wp-content/uploads/2022/08/venugopal.png?fit=436%2C534&ssl=1': #authentication.principal.account.accountInfo.avatar}"
                     class="profile-pic" alt="Profile Picture">
                <button class="border-0 camera-icon" style="margin-right: -20px" type="button" data-bs-toggle="modal"
                        data-bs-target="#avatar">
                    <img src="https://icons.iconarchive.com/icons/iconsmind/outline/512/Camera-icon.png"
                         class="camera-icon"
                         alt="Camera Icon" width="24px">
                </button>
            </div>
            <div class="profile-info">
                <h1>[[${#authentication.principal.account.accountInfo.fullName}]] <i
                        th:if="${#authentication.principal.account.verifiedAccount}"
                        class="text-primary bi bi-patch-check-fill"></i></h1>
                <p class="location" th:unless="${info.otherName == null or info.otherName.isEmpty()}">
                    ([[${info.otherName}]])</p>
                <p class="followers"><span id="followerCount">[[${#authentication.principal.account.accountDetails.followers}]]</span>
                    followers • <span id="followingCount">[[${#authentication.principal.account.accountDetails.following}]]</span>
                    following</p>
                <div class="following">
                    <th:block th:each="friend : ${listFriends}">
                        <img th:src="@{${friend.friendInfo.accountInfo.avatar}}"
                             th:alt="${friend.friendInfo.accountInfo.fullName}">
                    </th:block>
                </div>
            </div>
        </div>
    </div>
    <div class="mt-3 rounded-1">
        <nav th:replace="~{layout/_navbar_profile::navbar}"></nav>
    </div>
    <div class="row mt-3">
        <div class="col-4">
            <div class="profile-card">
                <div class="intro">Intro</div>
                <form th:action="@{/profile/updateBio}" method="post" id="updateBio">
                    <div class="bio text-center">
                        <div id="div-show" style="display: block"
                             th:text="${info.bio}">Bio
                        </div>
                        <textarea style="display: none" id="input-show" name="bio"
                                  class="form-control border-0 bg-transparent" placeholder="Bio"
                                  th:text="${info.bio}"></textarea>
                    </div>
                    <div class="d-grid gap-2 mt-3">
                        <button id="btn-edit" type="button" class="btn fw-bold border border-light-subtle">Edit bio
                        </button>
                        <div id="div-control" class="row" style="display: none">
                            <div class="col-6 d-grid gap-2 mt-3">
                                <button id="btn-cancel" type="button" class="btn fw-bold border border-light-subtle">
                                    Cancel
                                </button>
                            </div>
                            <div class="col-6 d-grid gap-2 mt-3">
                                <button id="btn-save" type="button" class="btn fw-bold border border-light-subtle">
                                    Save
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
                <hr>
                <ul class="details">
                    <li><i class="bi bi-info-circle-fill text-secondary"></i><span>Profile · Public figure</span></li>
                    <li th:unless="${info.work == null or info.work.isEmpty()}"><i
                            class="bi bi-briefcase-fill text-secondary"></i><span>Works at <strong
                            th:text="${info.work}">Work</strong></span></li>
                    <li th:unless="${info.education == null or info.education.isEmpty()}"><i
                            class="bi bi-building-fill text-secondary"></i><span>Studies at <strong
                            th:text="${info.education}">Education</strong></span>
                    </li>
                    <li th:unless="${info.currentCity == null or info.currentCity.isEmpty()}"><i
                            class="bi bi-house-door-fill text-secondary"></i><span>Lives in <strong
                            th:text="${info.currentCity}">CurrentCity</strong></span>
                    </li>
                    <li th:unless="${info.hometown == null or info.hometown.isEmpty()}"><i
                            class="bi bi-geo-alt-fill text-secondary"></i><span>From <strong
                            th:text="${info.hometown}">From</strong></span>
                    </li>
                    <li th:unless="${info.relationship == null}"><i
                            class="bi bi-heart-fill text-secondary"></i><span
                            th:text="${info.relationship.statusName}">Relationship</span>
                    </li>
                    <li class="d-grid gap-2 mt-3">
                        <button type="button" class="btn fw-bold border border-light-subtle" data-bs-toggle="modal"
                                data-bs-target="#ediDetailMoal">
                            Edit details
                        </button>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-8">
           <div th:if="${listPost.isEmpty()}" style="height: 1000px;"></div>
            <th:block th:each="p : ${listPost}">
                <div class="mb-3 shadow-lg p-3 mb-5 bg-body-tertiary rounded p-3">
                    <div class="profile-container mb-2">
                        <img th:src="${p.account.accountInfo.avatar}"
                             class="rounded-circle" alt="..." width="40px">
                        <div class="profile-text text-start">
                            <p class="fw-bold mb-0">[[${p.account.accountInfo.fullName}]] <i th:if="${p.account.verifiedAccount}" class="text-primary bi bi-patch-check-fill"></i>
                            </p>
                            <p class="text-muted text-start small mb-0" th:text="${p.createDate}">Create Date</p>
                        </div>
                    </div>
                    <p th:text="${p.content}">
                        Content
                    </p>
                    <div class="d-flex justify-content-center align-items-center">
                        <img th:src="${p.urlImage}"
                             class="rounded d-block" alt="..." width="50%">
                    </div>
                    <div class="row border-top d-flex p-2 mt-3">
                        <div class="col">
                            109K <i class="bi bi-hand-thumbs-up"></i> Like
                        </div>
                        <div class="col">
                            43.7K <i class="bi bi-chat"></i> Comment
                        </div>
                        <div class="col">
                            3.6K <i class="bi bi-share"></i> Share
                        </div>
                    </div>
                </div>
            </th:block>
        </div>
    </div>


    <!-- Modal Edit Details-->
    <div class="modal fade" id="ediDetailMoal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <form class="modal-dialog" method="post" th:action="@{/profile/update}" id="editDetails"
              th:object="${accountInfo}">
            <input type="hidden" th:field="*{id}">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5 text-center" id="exampleModalLabel">Edit details</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control col-6" id="otherName" placeholder="otherName"
                               th:field="*{otherName}">
                        <label for="otherName">Other name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="work" placeholder="work" th:field="*{work}">
                        <label for="work">Work at</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="student-at" placeholder="education"
                               th:field="*{education}">
                        <label for="student-at">Student at</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="lives-in" placeholder="currentCity"
                               th:field="*{currentCity}">
                        <label for="lives-in">Lives in</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="from" placeholder="hometown" th:field="*{hometown}">
                        <label for="from">From</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="date" class="form-control" id="date-of-birth" placeholder="ate-of-birth"
                               th:field="*{dateOfBirth}">
                        <label for="date-of-birth">Date of birth</label>
                    </div>
                    <div class="form-floating mb-3">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="gender" id="genderMale"
                                   th:field="*{gender}" value="1">
                            <label class="form-check-label" for="genderMale">Male</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="gender" id="genderFemale"
                                   th:field="*{gender}" value="0">
                            <label class="form-check-label" for="genderFemale">Female</label>
                        </div>
                    </div>
                    <div class=" mb-3">
                        <select class="form-select" th:field="*{relationship}">
                            <option th:value="${null}" selected>Relationship</option>
                            <option th:each="relationship : ${relationships}" th:value="${relationship.id}">
                                [[${relationship.statusName}]]
                            </option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" onclick="editDetailsSubmit()" class="btn btn-primary">Save</button>
                </div>
            </div>
        </form>
    </div>

    <!--    Edit Avatar-->
    <div class="modal fade" id="avatar" tabindex="-1" aria-labelledby="avatar" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="title">Choose profile picture</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-center">
                        <img id="avatarImage"
                             th:src="${#authentication.principal.account.accountInfo.avatar == null ? 'https://i0.wp.com/www.vidyadhirajamvk.org/wp-content/uploads/2022/08/venugopal.png?fit=436%2C534&ssl=1': #authentication.principal.account.accountInfo.avatar}"
                             class="rounded-circle" alt="avatar" width="200px" height="200px">
                    </div>
                    <div class="mt-5">
                        <input class="form-control" type="file" id="formFile" accept="image/*, video/*">
                    </div>
                </div>
                <div class="modal-footer">
                    <form th:action="@{/profile/updateAvatar}" method="post" id="submit-avatar">
                        <input type="hidden" name="avatar" id="avatarInput">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <!--                        <button id="save-avatar" type="button" class="btn btn-primary">Save</button>-->
                        <button id="save-avatar" type="button" class="btn btn-primary" onclick="handleSaveClick()">
                            <span id="save-text">Save</span>
                            <span id="save-loader" class="spinner-border spinner-border-sm d-none" role="status"
                                  aria-hidden="true"></span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>
</body>
</html>